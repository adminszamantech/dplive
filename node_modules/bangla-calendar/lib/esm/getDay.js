import { isValidDate, errorMessage, formatDay, isLeapYear, startJulianDate, getJulianDate, monthLengthIN, yearLength } from './utils.js';

function getDayBD(day, month, year) {
    var banglaDay;
    switch (month) {
        case 0:
            banglaDay = day < 15 ? day + 16 : day - 14;
            break;
        case 1:
            banglaDay = day < 14 ? day + 17 : day - 13;
            break;
        case 2:
            if (isLeapYear(year)) {
                banglaDay = day < 15 ? day + 16 : day - 14;
            }
            else {
                banglaDay = day < 15 ? day + 15 : day - 14;
            }
            break;
        case 3:
            banglaDay = day < 14 ? day + 17 : day - 13;
            break;
        case 4:
            banglaDay = day < 15 ? day + 17 : day - 14;
            break;
        case 5:
            banglaDay = day < 15 ? day + 17 : day - 14;
            break;
        case 6:
            banglaDay = day < 16 ? day + 16 : day - 15;
            break;
        case 7:
            banglaDay = day < 16 ? day + 16 : day - 15;
            break;
        case 8:
            banglaDay = day < 16 ? day + 16 : day - 15;
            break;
        case 9:
            banglaDay = day < 17 ? day + 15 : day - 16;
            break;
        case 10:
            banglaDay = day < 16 ? day + 15 : day - 15;
            break;
        default:
            banglaDay = day < 16 ? day + 15 : day - 15;
            break;
    }
    return banglaDay;
}
function getDayIN(day, month, year) {
    var julianDate = getJulianDate(year, month + 1, day);
    if (julianDate < startJulianDate) {
        throw new Error(errorMessage);
    }
    var banglaYear = Math.floor((julianDate - startJulianDate) / yearLength);
    var calculatedJulianDate = startJulianDate + banglaYear * yearLength;
    var ps;
    var ns;
    var banglaDay;
    for (var i = 0; i < 12; i += 1) {
        ps = calculatedJulianDate + monthLengthIN[i];
        ns = calculatedJulianDate + monthLengthIN[i + 1];
        if (julianDate >= ps && julianDate <= Math.floor(ns) + 1.75) {
            banglaDay = Math.floor(julianDate - ps) + 1;
        }
    }
    return banglaDay;
}
function getDay(date, options) {
    if (date === void 0) { date = new Date(); }
    if (options === void 0) { options = { format: 'D', calculationMethod: 'BD' }; }
    if (!isValidDate(date)) {
        throw new Error(errorMessage);
    }
    var inputDate = new Date(date);
    inputDate.setTime(inputDate.getTime() + (inputDate.getTimezoneOffset() + 360) * 60 * 1000);
    var day = inputDate.getUTCDate();
    var month = inputDate.getMonth();
    var year = inputDate.getFullYear();
    var format = options.format, _a = options.calculationMethod, calculationMethod = _a === void 0 ? 'BD' : _a;
    var banglaDay = calculationMethod === 'BD'
        ? getDayBD(day, month, year)
        : getDayIN(day, month, year);
    var result = formatDay(banglaDay, format);
    return result;
}

export { getDay };
